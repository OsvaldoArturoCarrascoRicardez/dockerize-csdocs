# Instalacion y Configuracion PHP 8.1 CENTOS 7

### **`PHP 8.1`**

## **Requisitos Previos**

Asegúrate de tener acceso a un servidor CentOS 7 con privilegios de superusuario (root).

## **1. Eliminar PHP 7 para evitar conflictos**

Si tienes versiones anteriores de PHP instaladas, es recomendable desinstalarlas primero:

```bash
sudo yum remove php php-cli php-common
```

## **2. Instalar el repositorio EPEL (Extra Packages for Enterprise Linux)**

```bash
sudo yum install epel-release
```

## **3. Instalar el repositorio Remi**

```bash
sudo yum install https://rpms.remirepo.net/enterprise/remi-release-7.rpm
```

## **4. Habilitar el módulo Remi para PHP 8.1**

Instala `yum-utils` y habilita el módulo Remi específico para PHP 8.1:

```bash
sudo yum install yum-utils
sudo yum-config-manager --disable 'remi-php*'
sudo yum-config-manager --enable remi-php81
```

## **5. Instalar PHP 8.1 y sus extensiones**

Instala PHP 8.1 junto con las extensiones necesarias:

```bash
sudo yum install php php-common \
php-cli php-fpm php-gd php-curl php-mysqlnd php-ldap php-zip php-zlib \
php-fileinfo php-gettext php-snmp php-mbstring php-pecl-zip php-xmlrpc \
php-xml php-yaml mod_php
```

**Extensiones adicionales**:

Si necesitas más extensiones, puedes instalarlas de la siguiente manera:

```bash
sudo yum install php-imagick php-bz2 php-intl php-readline php-bcmath php-calendar php-sockets
```

## **6. Iniciar y habilitar PHP-FPM**

Primero, reinicia el servidor web (Nginx o Apache) y luego PHP-FPM:

```bash
sudo yum install php-fpm

sudo systemctl enable php-fpm

sudo systemctl start php-fpm

sudo systemctl status php-fpm

sudo systemctl restart nginx

sudo systemctl restart php-fpm
```

Habilita PHP-FPM para que se inicie automáticamente al arrancar el sistema:

```bash
sudo systemctl enable php-fpm
```

## **7. Verificar el estado de PHP-FPM**

Asegúrate de que el servicio PHP-FPM esté en ejecución:

```bash
sudo systemctl status php-fpm
```

## **8. Verificar la instalación de PHP**

Después de la instalación, verifica que PHP 8.1 esté instalado correctamente y que las extensiones necesarias estén cargadas:

```bash
php -v
php -m | grep -E 'imagick|bz2|curl|intl|mysqlnd|readline|mbstring|bcmath|gd|xml|xsl|soap|zip|cgi|redis|gettext|bcmath'
```

---

## **Errores Comunes y Soluciones**

### **Error de Resolución de Host**

Si encuentras un error similar al siguiente al intentar instalar paquetes:

```
Could not retrieve mirrorlist http://mirrorlist.centos.org/?release=7&arch=x86_64&repo=os&infra=stock error was 14: curl#6 - "Could not resolve host: mirrorlist.centos.org; Error desconocido"
```

#### **Solución: Problemas de DNS**

1. **Configura servidores DNS válidos**:

   Abre el archivo de configuración DNS:

   ```bash
   sudo nano /etc/resolv.conf
   ```

   Añade las siguientes líneas:

   ```plaintext
   nameserver 8.8.8.8
   nameserver 8.8.4.4
   ```

   Guarda y cierra el archivo.

2. **Verifica los archivos de repositorio**:

   Asegúrate de que los archivos de repositorio en `/etc/yum.repos.d/` estén correctamente configurados y no corruptos.

3. **Actualizar el Caché de YUM**:

   Limpia y actualiza el caché de YUM:

   ```bash
   sudo yum clean all
   sudo yum makecache
   ```

### **Error con el Archivo `CentOS-Base.repo`**

Si el problema persiste, considera cambiar la configuración para usar `baseurl` en lugar de `mirrorlist`:

1. **Editar el archivo `CentOS-Base.repo`**:

   ```bash
   sudo nano /etc/yum.repos.d/CentOS-Base.repo
   ```

2. **Modificar el archivo**:

   Cambia las líneas de `mirrorlist` por `baseurl`:

```ini
[base]
name=CentOS-$releasever - Base
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os&infra=$infra
baseurl=http://vault.centos.org/7.9.2009/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

[updates]
name=CentOS-$releasever - Updates
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates&infra=$infra
baseurl=http://vault.centos.org/7.9.2009/updates/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

[extras]
name=CentOS-$releasever - Extras
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras&infra=$infra
baseurl=http://vault.centos.org/7.9.2009/extras/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

[centosplus]
name=CentOS-$releasever - Plus
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus&infra=$infra
baseurl=http://vault.centos.org/7.9.2009/centosplus/$basearch/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```

Haz lo mismo para las secciones de `updates`, `extras`, y `centosplus`.

3. **Guardar y salir**:

Si usas `nano`, guarda el archivo presionando `CTRL + O`, luego presiona `Enter` y sal con `CTRL + X`.

4. **Limpiar el caché de YUM y reintentar la instalación**:

```bash
sudo yum clean all
sudo yum makecache
```